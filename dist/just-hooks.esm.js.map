{"version":3,"file":"just-hooks.esm.js","sources":["../src/useTransferList.ts","../src/wrapFetch.ts"],"sourcesContent":["import { useState } from 'react';\n\nconst equalityCompare: (item: any, addOrRemoveItem: any) => boolean = (\n  item,\n  addOrRemoveItem\n) => {\n  const typeofItem = typeof item;\n  const typeofAddOrRemoveItem = typeof addOrRemoveItem;\n\n  if (\n    (typeofItem === 'number' && typeofAddOrRemoveItem === 'number') ||\n    (typeofItem === 'string' && typeofAddOrRemoveItem === 'string')\n  ) {\n    return item === addOrRemoveItem;\n  }\n\n  return item.id === addOrRemoveItem.id;\n};\n\nexport interface KeyedObject {\n  id: string | number;\n}\n\n/**\n *\n * @param initialStartList list of initial start items. Item's type can be number, string or object that has an `id` field\n * @param initialEndList (optional) list of initial end items. Item's type can be number, string or object that has an `id` field\n * @returns\n * {\n *   startList: list of initial items,\n *   endList: list of items that have been transfered to,\n *   transfer(): transfer item to end list,\n *   withdraw(): withdraw item back to start list\n * }\n */\nexport default function useTransferList<\n  T extends number | string | KeyedObject\n>(initialStartList: T[], initialEndList?: T[]) {\n  const [startList, setStartList] = useState<T[]>(initialStartList);\n  const [endList, setEndList] = useState<T[]>(initialEndList || []);\n\n  const transfer = (item: T) => {\n    const index = startList.findIndex(it => equalityCompare(it, item));\n    if (index > -1) {\n      const items = startList.splice(index, 1);\n      setEndList([...endList, ...items]);\n      setStartList(startList);\n    }\n  };\n\n  const withdraw = (item: T) => {\n    const index = endList.findIndex(it => equalityCompare(it, item));\n    if (index > -1) {\n      const items = endList.splice(index, 1);\n      setStartList([...startList, ...items]);\n      setEndList(endList);\n    }\n  };\n\n  return {\n    startList,\n    endList,\n    transfer,\n    withdraw,\n  };\n}\n","export class APIError<T> extends Error {\n  public data: T | undefined;\n  private code: string | undefined;\n\n  constructor(message: string, code?: string, data?: T) {\n    super(message);\n\n    this.code = code || 'Unknown';\n    this.data = data;\n  }\n\n  public toString() {\n    return `[${this.code}] ${this.message}`;\n  }\n}\nconst getResponseType = (contentType: string) => {\n  if (\n    contentType.indexOf('application/json') > -1 ||\n    contentType.indexOf('application/ld+json') > -1 ||\n    contentType.indexOf('application/vnd.api+json') > -1\n  ) {\n    return 'json';\n  } else if (\n    contentType.indexOf('text/') > -1 ||\n    contentType.indexOf('application/javascript') > -1\n  ) {\n    return 'text';\n  } else if (contentType.indexOf('multipart/form-data') > -1) {\n    return 'formData';\n  } else if (\n    contentType.indexOf('image/') > -1 ||\n    contentType.indexOf('audio/') > -1 ||\n    contentType.indexOf('application/zip') > -1 ||\n    contentType.indexOf('application/pdf') > -1 ||\n    contentType.indexOf('application/msword') > -1\n  ) {\n    return 'blob';\n  } else {\n    return null;\n  }\n};\n\nexport type APIResponse<T = unknown> =\n  | {\n      ok: true;\n      data: T;\n      origin: Response;\n    }\n  | {\n      ok: false;\n      error: APIError<T>;\n      origin?: Response;\n    };\n\nexport async function safeFetch<T = unknown>(\n  input: RequestInfo,\n  init?: RequestInit\n): Promise<APIResponse<T>> {\n  try {\n    const response = await fetch(input, init);\n    const contenttype = response.headers.get('Content-Type');\n    const responseType = contenttype\n      ? getResponseType(contenttype.toLocaleLowerCase())\n      : null;\n\n    let data;\n    let ok = response.ok;\n    if (responseType) {\n      try {\n        data = (await response[responseType]()) as T;\n        if (!response.ok) {\n          data = new APIError(\n            response.statusText,\n            String(response.status),\n            data\n          );\n        }\n      } catch (error) {\n        ok = false;\n        data = new APIError(error.toString());\n      }\n    } else {\n      data = new APIError('Unsupport header content-type: ' + contenttype);\n      ok = false;\n    }\n\n    if (ok) {\n      return {\n        ok: true,\n        data: data as T,\n        origin: response,\n      };\n    } else {\n      return {\n        ok: false,\n        error: data as APIError<T>,\n        origin: response,\n      };\n    }\n  } catch {\n    return {\n      ok: false,\n      error: new APIError('Unexpected error'),\n    };\n  }\n}\n"],"names":["equalityCompare","item","addOrRemoveItem","typeofItem","typeofAddOrRemoveItem","id","useTransferList","initialStartList","initialEndList","startList","setStartList","useState","endList","setEndList","transfer","index","findIndex","it","items","splice","withdraw","APIError","Error","constructor","message","code","data","toString","getResponseType","contentType","indexOf","safeFetch","input","init","response","fetch","contenttype","headers","get","responseType","toLocaleLowerCase","ok","statusText","String","status","error","origin"],"mappings":"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"}